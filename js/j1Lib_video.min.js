var j1Lib_video=function(e){var t=e.render,n=e.control,i=e.thread;void 0==i&&(i=3);var r=e.worker;void 0==r&&(r=!0);var o=e.fps;void 0==o&&(o=60);var a=e.autoplay;void 0==a&&(a=!1);var s=e.acao;void 0==s&&(s=!0);var d=e.preload;void 0==d&&(d=!0);var u=this,l=0,f=0;this.resize=function(e){l=e.width,f=e.height},this.resize(t),t.addEventListener("click",function(){L&&(L.paused?L.play():(n.setProgress(y,L.currentTime),L.pause()))}),n.setVideo(this);var c=null,v=[],h=function(e){t.fillStyle="rgba(33,33,33,0.8)",t.fillRect(0,0,l,f),t.fillStyle="white",t.fillText(e,50,50)},p=function(e){e.addEventListener("play",function(){if(L==this){var e=this;g=setInterval(function(){t.drawImage(e,0,0,l,f)},o),n.hide()}}),e.addEventListener("pause",function(){L==this&&(clearInterval(g),n.show(),h(c))}),e.addEventListener("ended",function(){if(L==this){clearInterval(g);var e=v.indexOf(this);E(v[e+1])}})},m=function(e){var t=document.createElement("video");return t.src=e,t.preload="auto",t},g=null,L=null,y=null,E=function(e){L=e,y=v.indexOf(e),e.currentTime=0,e.muted=!1,e.play()},b="";this.src="",Object.defineProperty(this,"src",{get:function(){return b},set:function(e){b=e,j1Lib_ajax(e+".json",function(e){if(e=JSON.parse(e.response),c=e.title,"object"==typeof e.video.part)for(var i=0;i<e.video.part.length;i++)v.push(e.video.part[i]);else for(var i=0;i<=e.video.part;i++)v.push(e.video.server.replace("%server%",location.hostname)+"_"+i+"."+e.video.format);T(function(){t=t.getContext("2d"),h("播放器初始化中……"),L=v[0],y=0}),u.duration=e.length,u.part=e.video.part,n.setPart(v.length),n.setLength(e.length)},function(){t=t.getContext("2d"),h("錯誤: 影片不存在")}).send()}});var j=function(e,t){j1Lib_video_ajax(v[e],function(i){(s||0==e||!d)&&n.setBuffered(e),void 0!=v[e]&&(v[e]=m(i,!1),0==e&&v[e].addEventListener("loadedmetadata",function(){this.removeEventListener("loadedmetadata",arguments.callee),setTimeout(function(){a?v[0].play():h("按一下播放 "+c)},1e3)}),v[e].addEventListener("error",function(){h("錯誤: 播放器緩存衝突")},!0)),!s&&0!=e&&d?(v[e].play(),v[e].muted=!0,v[e].addEventListener("progress",function(e){if(this.buffered.length){var t=this.buffered.end(0)/this.duration*100;t>=100?this.removeEventListener("progress",arguments.callee):this.currentTime=this.buffered.end(0)}}),v[e].addEventListener("ended",function(i){this.removeEventListener("ended",arguments.callee),t(),p(v[e]),n.setBuffered(e)})):(t(),p(v[e]))},r,!s||0==e)},x=0,w=function(){j(x++,function(){x<v.length?w():0==--i&&console.log("Download Complete")})},T=function(e){j(x++,function(){e();for(var t=0;i>t;t++)w()})};this.pause=function(){L.pause()},this.play=function(){L.play()},this.playAt=function(e,t){"object"==typeof v[e]&&(L.pause(),E(v[e]),L.currentTime=t)},this.duration="",this.part=0};