!function(){document.addEventListener("DOMContentLoaded",function(){var e=document.getElementsByTagName("j1Lib_video");requestAFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e,t){return window.setTimeout(e,t.fps)}}(),cancelAFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(e){window.clearTimeout(e)}}();for(var t=function(e){!function(t,n){for(var o=0,i=0;t-i;i++)!function(t){var n=o+t;e.controls.fillStyle="white",e.controls.fillRect(o,0,t,15),o=n}(n/e.length*e.controls_length[i])}(e.controls_length.length,e.w)},n=function(e,t){return c((window.URL||window.webkitURL).createObjectURL(e),!0,t)},o=function(e,t,o,i){if(i.acao)if(i.worker){var r=new Worker("js/j1Lib_video_ajax_worker.min.js");r.postMessage({url:e}),r.onmessage=function(e){t(n(e.data,i))}}else{var r=j1Lib_ajax(e,function(e){t(n(e.response,i))},o);r.responseType="blob",r.send()}else{var r=c(e,!0,i);r.muted=!0,r.play(),r.addEventListener("progress",function(e){if(e.stopPropagation(),this.buffered.length){var t=this.buffered.end(0)/this.duration*100;t>=100?this.removeEventListener("progress",arguments.callee):this.currentTime=this.buffered.end(0)}}),r.addEventListener("ended",function(e){this.removeEventListener("ended",arguments.callee),e.stopPropagation(),t(r),r.muted=!1,r.currentTime=0})}},i=function(e,t){t.buffing++,t.e.buffered()?CustomEvent&&t.e.dispatchEvent(new CustomEvent("buffered",null)):t._video[e]&&"object"!=typeof t._video[e]&&e<=t._video.length&&o(t._video[e],function(n){t._video[e]=n,i(t.buffing,t)},function(){u("影片資源已過期。",!0,t)},t)},r=function(e,t){if(e)cancelAFrame(t.rendering),t.ctx.globalCompositeOperation="copy",t.rendering=requestAFrame(function(){t.ctx.drawImage(t.video,0,0,t.w,t.h),t.rendering=requestAFrame(arguments.callee,t)}),t.video.play(),CustomEvent&&t.e.dispatchEvent(new CustomEvent("play",null)),"object"==typeof t.controls&&(t._controls.style.display="none",t.controls_current.style.display="none");else if(t.video.pause(),cancelAFrame(t.rendering),t.ctx.globalCompositeOperation="source-over",u(t.title,!1,t),CustomEvent&&t.e.dispatchEvent(new CustomEvent("pause",null)),"object"==typeof t.controls){for(var n=t.video.currentTime,o=1;t.video_index>=o;o++)n+=t.controls_length[o-1];var i=t.w/t.length*n;t._controls.style.display="block",t.controls_current.style.display="block",t.controls_current.style.width=i+"px",t.controls_current.innerHTML=l(n)+"/"+l(t.length)}},a=function(e){return 10>e?"0"+e:e},l=function(e){return a(parseInt(e/60,0))+":"+a(parseInt(e,0)%60)},s=function(e,t){var n=e._video[t];e.video=n,e.video_index=t,n.addEventListener("ended",function(n){this.removeEventListener("ended",arguments.callee),n.stopPropagation(),this==e.video&&(cancelAFrame(e.rendering),"object"==typeof e._video[++t]?s(e,t):e.e.buffered()?u("影片資源已過期。",!0,e):u("影片資源緩存中……",!0,e))}),r(!0,e)},c=function(e,n,o){var i=document.createElement("video");return i.src=e,n?i.preload="auto":i.preload="metadata",i.autoplay="",i.addEventListener("loadedmetadata",function(e){this.removeEventListener("loadedmetadata",arguments.callee),e.stopPropagation(),o.controls_length.push(this.duration),"object"==typeof o.controls&&t(o)}),i},d=function(e,t,n,o,i,r){var a=t[e++];a?a.hasAttribute("src")?(u("處理影片資源 #"+e+"……",i,r),j1Lib_ajax(a.getAttribute("src"),function(a){try{n(JSON.parse(a.response))}catch(l){d(e,t,n,o,i,r)}},function(){d(e,t,n,o,i,r)}).send()):d(e,t,n,o,i,r):o()},u=function(e,t,n){var o=n.w,i=n.h;n.ctx.fillStyle="rgba(33,33,33,0.8)",n.ctx.fillRect(0,0,o,i),n.ctx.font="15px 微軟正黑體",n.ctx.fillStyle="white",t?(n.ctx.textAlign="center",o/=2,i/=2):(n.ctx.textAlign="left",o=50,i=50),n.ctx.fillText(e,o,i)},f=0;e.length-f;f++)!function(e){var n={e:null,w:0,h:0,ctx:null,title:null,length:0,video:null,_video:[],video_index:0,rendering:null,thread:0,buffing:1,worker:!0,acao:!0,controls:null,_controls:null,controls_current:null,controls_length:[],fps:60,autoplay:!1};n.e=e,e.style.display="block",e.style.position="absolute",e.hasAttribute("thread")?n.thread=parseInt(e.getAttribute("thread")):n.thread=3,n.worker=e.hasAttribute("worker"),e.hasAttribute("crossorigin")&&"bypass"==e.getAttribute("crossorigin")?n.acao=!1:n.acao=!0,e.hasAttribute("fps")?n.fps=parseInt(e.getAttribute("fps")):n.fps=60,n.autoplay=e.hasAttribute("autoplay");var o=document.createElement("canvas");if(o.style.transform="translateZ(0)",n.ctx=o.getContext("2d"),e.appendChild(o),e.hasAttribute("controls")){var a=document.createElement("canvas");n.controls=a.getContext("2d"),a.style.display="none",a.style.position="absolute",a.style.bottom="0px",a.style.left="0px",n.controls.globalCompositeOperation="copy",a.style.transform="translateZ(0)",n._controls=a,a.addEventListener("click",function(e){e.stopPropagation(),function(e,t){for(var o=0,i=0;t-o&&(i=n.controls_length[o],!(i>e));o++)e-=n.controls_length[o];if(i>e){u("影片資源緩存中……",!0,n);var r=n.video;s(n,o),n.video.currentTime=e,r.currentTime=r.duration}}(n.length/n.w*e.offsetX,n.controls_length.length)}),e.appendChild(a);var l=document.createElement("div");l.style.backgroundColor="#F44336",l.style.display="none",l.style.position="absolute",l.style.bottom="0px",l.style.left="0px",l.style.width="0px",l.style.fontSize="0.5em",l.style.paddingLeft="1em",n.controls_current=l,e.appendChild(l)}var f=function(){n.w=e.getAttribute("width")||100,n.h=e.getAttribute("height")||100,e.style.width=n.w+"px",e.style.height=n.h+"px",o.width=n.w,o.height=n.h,o.style.display="block","object"==typeof n.controls&&(a.width=n.w,a.height="15",a.style.opacity="0.2",a.style.zIndex="1",l.style.height=a.height+"px",t(n))};window.addEventListener("resize",f),f();var p=e.getElementsByTagName("source");u("j1Lib_Video 1.0",!0,n),p.length?d(0,p,function(t){n.title=t.title,n.length=t.length,u(t.title,!0,n);var o=t.video.server||"",a=t.video.format||"",l=t.video.part;if("object"==typeof l&&(l=l.length-1),l){for(var d=0;l>=d;d++)!function(e){"object"==typeof t.video.part&&(e=t.video.part[d]),n._video.push(o+e+a)}(d);var f=c(n._video[0],!0,n);n._video[0]=f,e.addEventListener("click",function(e){e.stopPropagation(),n.video?r(n.video.paused,n):n.autoplay||(u("影片資源緩存中……",!0,n),n.autoplay=!0,s(n,0))}),n.autoplay&&s(n,0),e.pause=function(){r(!1,n)},e.play=function(){r(!0,n)},e.paused=function(){return n.video.paused},e.buffered=function(){return n.buffing==n._video.length+n.thread},n.buffing=1;for(var d=1;d<=n.thread;d++)!function(e){i(e,n)}(d)}else u("空白影片資源。",!0,n)},function(){u("影片資源已過期。",!0,n)},!0,n):u("無效影片資源。",!0,n)}(e[f])})}();